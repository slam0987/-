<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لعبة محاكاة المزرعة</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-size: 20px;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 10px;
    }
  </style>
</head>
<body>
  <div id="ui">
    <p>عدد المحاصيل: <span id="cropCount">0</span></p>
    <p>عدد الحيوانات: <span id="animalCount">1</span></p>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // إعداد المشهد
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // إضافة إضاءة
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(10, 10, 10).normalize();
    scene.add(light);

    // إنشاء أرضية المزرعة
    const groundGeometry = new THREE.PlaneGeometry(100, 100);
    const groundMaterial = new THREE.MeshPhongMaterial({ color: 0x228B22 });
    const ground = new THREE.Mesh(groundGeometry, groundMaterial);
    ground.rotation.x = -Math.PI / 2;
    scene.add(ground);

    // إعداد كاميرا العرض
    camera.position.z = 20;
    camera.position.y = 10;
    camera.lookAt(ground.position);

    // إضافة شجرة بسيطة
    function createTree(x, z) {
      const trunkGeometry = new THREE.CylinderGeometry(0.5, 0.5, 2);
      const trunkMaterial = new THREE.MeshPhongMaterial({ color: 0x8B4513 });
      const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);

      const leavesGeometry = new THREE.SphereGeometry(1.5);
      const leavesMaterial = new THREE.MeshPhongMaterial({ color: 0x228B22 });
      const leaves = new THREE.Mesh(leavesGeometry, leavesMaterial);

      trunk.position.set(x, 1, z);
      leaves.position.set(x, 3, z);

      scene.add(trunk);
      scene.add(leaves);
    }

    createTree(5, 5);
    createTree(-5, -5);

    // إنشاء اللاعب (مكعب بسيط مؤقتًا)
    const playerGeometry = new THREE.BoxGeometry(1, 2, 1);
    const playerMaterial = new THREE.MeshPhongMaterial({ color: 0xff0000 });
    const player = new THREE.Mesh(playerGeometry, playerMaterial);
    player.position.set(0, 1, 0);
    scene.add(player);

    // التحكم في حركة اللاعب
    const controls = { forward: false, backward: false, left: false, right: false };

    window.addEventListener('keydown', (event) => {
      if (event.key === 'w') controls.forward = true;
      if (event.key === 's') controls.backward = true;
      if (event.key === 'a') controls.left = true;
      if (event.key === 'd') controls.right = true;
    });

    window.addEventListener('keyup', (event) => {
      if (event.key === 'w') controls.forward = false;
      if (event.key === 's') controls.backward = false;
      if (event.key === 'a') controls.left = false;
      if (event.key === 'd') controls.right = false;
    });

    function updatePlayer() {
      if (controls.forward) player.position.z -= 0.1;
      if (controls.backward) player.position.z += 0.1;
      if (controls.left) player.position.x -= 0.1;
      if (controls.right) player.position.x += 0.1;
    }

    // نظام المحاصيل
    let crops = [];
    function createCropField(x, z) {
      const cropFieldGeometry = new THREE.PlaneGeometry(5, 5);
      const cropFieldMaterial = new THREE.MeshPhongMaterial({ color: 0x8B4513 });
      const cropField = new THREE.Mesh(cropFieldGeometry, cropFieldMaterial);
      cropField.rotation.x = -Math.PI / 2;
      cropField.position.set(x, 0, z);
      cropField.isCropField = true;
      scene.add(cropField);
      return cropField;
    }

    createCropField(10, 10);
    createCropField(-10, 10);

    function plantCrop(field) {
      const cropGeometry = new THREE.BoxGeometry(0.5, 1, 0.5);
      const cropMaterial = new THREE.MeshPhongMaterial({ color: 0x32CD32 });
      const crop = new THREE.Mesh(cropGeometry, cropMaterial);
      crop.position.set(field.position.x, 0.5, field.position.z);
      scene.add(crop);
      crops.push(crop);
    }

    window.addEventListener('keydown', (event) => {
      if (event.key === ' ') {
        const closestField = getClosestCropField(player.position);
        if (closestField && !closestField.isPlanted) {
          plantCrop(closestField);
          closestField.isPlanted = true;
        }
      }
    });

    function getClosestCropField(position) {
      let closestField = null;
      let minDistance = Infinity;
      scene.children.forEach((object) => {
        if (object.isCropField) {
          const distance = position.distanceTo(object.position);
          if (distance < minDistance) {
            closestField = object;
            minDistance = distance;
          }
        }
      });
      return closestField;
    }

    // إضافة البقرة
    function createCow(x, z) {
      const bodyGeometry = new THREE.BoxGeometry(1.5, 1, 0.7);
      const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0x8B4513 });
      const body = new THREE.Mesh(bodyGeometry, bodyMaterial);

      const headGeometry = new THREE.SphereGeometry(0.5);
      const headMaterial = new THREE.MeshPhongMaterial({ color: 0x8B4513 });
      const head = new THREE.Mesh(headGeometry, headMaterial);
      head.position.set(x, 1, z + 0.9);

      body.position.set(x, 0.5, z);
      scene.add(body);
      scene.add(head);

      return { body, head };
    }

    const cow = createCow(5, -5);

    function moveAnimal(animal) {
      const direction = Math.random() > 0.5 ? 1 : -1;
      animal.body.position.x += direction * 0.02;
      animal.head.position.x += direction * 0.02;
    }

    // واجهة المستخدم (UI)
    function updateUI() {
      document.getElementById('cropCount').innerText = crops.length;
      document.getElementById('animalCount').innerText = 1;
    }

    setInterval(updateUI, 1000);

    // تحريك الكاميرا
    function updateCamera() {
      camera.position.x = player.position.x + 10;
      camera.position.z = player.position.z + 10;
      camera.lookAt(player.position);
    }

    // الحركة المستمرة
    function animate() {
      requestAnimationFrame(animate);
      updatePlayer();
      updateCamera();
      crops.forEach(crop => crop.scale.y += 0.001);
      moveAnimal(cow);
      renderer.render(scene, camera);
    }

    animate();
  </script>
</body>
</html>
